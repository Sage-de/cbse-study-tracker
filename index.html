<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arc Cards</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      --bg: #f5f5f7;
      --surface: #ffffff;
      --text: #1d1d1f;
      --muted: #6e6e73;
      --border: #e5e5ea;
      --accent: #0071e3;
      --shadow: 0 10px 30px rgba(0,0,0,.06);
      color-scheme: light dark;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b0b0c;
        --surface: #151516;
        --text: #f5f5f7;
        --muted: #9a9aa0;
        --border: #2a2a2b;
        --accent: #0a84ff;
        --shadow: 0 10px 30px rgba(0,0,0,.4);
      }
    }
    [data-theme="light"] { --bg: #f5f5f7; --surface: #ffffff; --text: #1d1d1f; --muted: #6e6e73; --border: #e5e5ea; --accent: #0071e3; --shadow: 0 10px 30px rgba(0,0,0,.06); }
    [data-theme="dark"] { --bg: #0b0b0c; --surface: #151516; --text: #f5f5f7; --muted: #9a9aa0; --border: #2a2a2b; --accent: #0a84ff; --shadow: 0 10px 30px rgba(0,0,0,.4); }

    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .app {
      display: grid;
      grid-template-columns: 280px 1fr;
      height: 100%;
    }

    .sidebar {
      border-right: 1px solid var(--border);
      padding: 24px 16px;
      background: linear-gradient(180deg, var(--surface), color-mix(in oklab, var(--surface), var(--bg) 25%));
    }

    .brand {
      display: flex; justify-content: space-between; align-items: center; gap: 8px;
      margin-bottom: 16px;
    }

    .title { font-size: 20px; font-weight: 600; letter-spacing: .2px; }
    .muted { color: var(--muted); font-size: 12px; }

    .deck-list { margin-top: 12px; display: grid; gap: 6px; }
    .deck {
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
      padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border);
      background: var(--surface);
      box-shadow: var(--shadow);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .deck:hover { transform: translateY(-1px); box-shadow: 0 12px 36px rgba(0,0,0,.08); }
    .deck.active { outline: 2px solid color-mix(in oklab, var(--accent), white 40%); }

    .deck-name { font-weight: 600; }
    .deck-count { font-variant-numeric: tabular-nums; }

    .add-row { display: flex; gap: 8px; margin-top: 12px; }
    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 12px;
      outline: none;
    }
    input::placeholder, textarea::placeholder { color: color-mix(in oklab, var(--muted), var(--text) 10%); }

    .btn {
      appearance: none; -webkit-appearance: none;
      padding: 10px 14px; border-radius: 12px; border: 1px solid var(--border);
      background: linear-gradient(180deg, color-mix(in oklab, var(--surface), white 4%), var(--surface));
      color: var(--text); cursor: pointer; font-weight: 600;
      transition: transform .05s ease, box-shadow .2s ease, background .2s ease;
    }
    .btn:active { transform: translateY(1px); }
    .btn.primary { border-color: color-mix(in oklab, var(--accent), black 20%); background: linear-gradient(180deg, color-mix(in oklab, var(--accent), white 15%), var(--accent)); color: white; }
    .btn.ghost { background: transparent; }
    .btn.danger { border-color: #e04848; color: #e04848; background: transparent; }

    .topbar { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-bottom: 1px solid var(--border); }

    .content { padding: 24px; overflow: auto; }
    .panel { max-width: 920px; margin: 0 auto; display: grid; gap: 16px; }

    .card { border: 1px solid var(--border); border-radius: 16px; background: var(--surface); box-shadow: var(--shadow); padding: 16px; }

    .flashcard { border-radius: 20px; padding: 36px; text-align: center; font-size: 22px; font-weight: 600; letter-spacing: .2px; }
    .flashcard .back { margin-top: 16px; font-weight: 500; color: var(--muted); }

    .answer-row { display: flex; gap: 12px; justify-content: center; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 900px) { .app { grid-template-columns: 1fr; } .sidebar { border-right: none; border-bottom: 1px solid var(--border); } .grid-2 { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div id="root" class="app"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    const storeKey = 'arc-cards-v1';
    const prefKey = 'arc-cards-theme';
    const uid = () => (crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2));

    function load() {
      try { return JSON.parse(localStorage.getItem(storeKey)) || { decks: [], cards: [] }; } catch { return { decks: [], cards: [] }; }
    }
    function save(state) { localStorage.setItem(storeKey, JSON.stringify(state)); }

    function useTheme() {
      const [theme, setTheme] = useState(() => localStorage.getItem(prefKey) || 'system');
      useEffect(() => {
        const root = document.documentElement;
        root.removeAttribute('data-theme');
        if (theme === 'light' || theme === 'dark') root.setAttribute('data-theme', theme);
        localStorage.setItem(prefKey, theme);
      }, [theme]);
      return [theme, setTheme];
    }

    function TopBar({ theme, setTheme }) {
      return (
        <div className="topbar">
          <div>
            <div style={{ fontWeight: 700, letterSpacing: .2 }}>Arc Cards</div>
            <div className="muted">Local-first flashcards</div>
          </div>
          <div style={{ display: 'flex', gap: 8 }}>
            <select value={theme} onChange={e => setTheme(e.target.value)} style={{ borderRadius: 12, padding: '8px 12px', border: '1px solid var(--border)', background: 'var(--surface)', color: 'var(--text)' }}>
              <option value="system">System</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
        </div>
      );
    }

    function Sidebar({ decks, activeId, setActiveId, addDeck, deleteDeck }) {
      const [name, setName] = useState('');
      return (
        <aside className="sidebar">
          <div className="brand">
            <div>
              <div className="title">Decks</div>
              <div className="muted">Study by collection</div>
            </div>
          </div>
          <div className="deck-list">
            {decks.map(d => (
              <div key={d.id} className={`deck ${activeId === d.id ? 'active' : ''}`}>
                <button className="btn ghost" style={{ padding: 0, border: 'none', background: 'transparent', textAlign: 'left', flex: 1 }} onClick={() => setActiveId(d.id)}>
                  <div className="deck-name">{d.name}</div>
                  <div className="muted deck-count">{d.count ?? 0} cards</div>
                </button>
                <button className="btn danger" onClick={() => deleteDeck(d.id)}>Delete</button>
              </div>
            ))}
          </div>
          <div className="add-row">
            <input value={name} onChange={e => setName(e.target.value)} placeholder="New deck" />
            <button className="btn primary" onClick={() => { const n = name.trim(); if (!n) return; addDeck(n); setName(''); }}>Add</button>
          </div>
        </aside>
      );
    }

    function CardEditor({ deck, addCard, importDeck, exportDeck }) {
      const [front, setFront] = useState('');
      const [back, setBack] = useState('');
      return (
        <div className="card">
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div style={{ fontWeight: 700 }}>Add Card â€” {deck?.name || ''}</div>
            <div style={{ display: 'flex', gap: 8 }}>
              <button className="btn" onClick={exportDeck}>Export</button>
              <label className="btn" style={{ display: 'inline-flex', alignItems: 'center', gap: 8 }}>
                Import
                <input type="file" accept="application/json" style={{ display: 'none' }} onChange={e => importDeck(e.target.files?.[0] || null)} />
              </label>
            </div>
          </div>
          <div className="grid-2" style={{ marginTop: 12 }}>
            <textarea value={front} onChange={e => setFront(e.target.value)} rows={3} placeholder="Front" />
            <textarea value={back} onChange={e => setBack(e.target.value)} rows={3} placeholder="Back" />
          </div>
          <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: 12 }}>
            <button className="btn primary" onClick={() => { const f = front.trim(); const b = back.trim(); if (!f || !b) return; addCard(f, b); setFront(''); setBack(''); }}>Add Card</button>
          </div>
        </div>
      );
    }

    function StudyView({ card, flip, isFlipped, answer }) {
      if (!card) return (
        <div className="card" style={{ textAlign: 'center' }}>
          <div className="muted">No cards due. Add more or come back later.</div>
        </div>
      );
      return (
        <div className="card">
          <div className="flashcard" onClick={flip} style={{ cursor: 'pointer' }}>
            <div>{card.front}</div>
            {isFlipped && <div className="back">{card.back}</div>}
          </div>
          <div className="answer-row">
            <button className="btn" onClick={() => answer('again')}>Again</button>
            <button className="btn primary" onClick={() => answer('good')}>Good</button>
            <button className="btn" onClick={() => answer('easy')}>Easy</button>
          </div>
        </div>
      );
    }

    function CardTable({ cards, deleteCard }) {
      return (
        <div className="card">
          <div style={{ fontWeight: 700, marginBottom: 8 }}>Cards</div>
          <div style={{ overflowX: 'auto' }}>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead>
                <tr style={{ textAlign: 'left', color: 'var(--muted)', fontSize: 12 }}>
                  <th style={{ padding: 8 }}>Front</th>
                  <th style={{ padding: 8 }}>Back</th>
                  <th style={{ padding: 8 }}>Due</th>
                  <th style={{ padding: 8 }}></th>
                </tr>
              </thead>
              <tbody>
                {cards.map(c => (
                  <tr key={c.id} style={{ borderTop: '1px solid var(--border)' }}>
                    <td style={{ padding: 8 }}>{c.front}</td>
                    <td style={{ padding: 8, color: 'var(--muted)' }}>{c.back}</td>
                    <td style={{ padding: 8 }}>{new Date(c.dueAt || Date.now()).toLocaleString()}</td>
                    <td style={{ padding: 8, textAlign: 'right' }}>
                      <button className="btn danger" onClick={() => deleteCard(c.id)}>Delete</button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    function App() {
      const [theme, setTheme] = useTheme();
      const [data, setData] = useState(() => {
        const s = load();
        if (s.decks.length === 0) {
          const d1 = { id: uid(), name: 'Mathematics' };
          const d2 = { id: uid(), name: 'Science' };
          s.decks = [d1, d2];
          s.cards = [
            { id: uid(), deckId: d1.id, front: 'What is 2 + 2?', back: '4', interval: 0, ease: 2.5, reps: 0, dueAt: Date.now() },
            { id: uid(), deckId: d2.id, front: 'State of matter at room temp for oxygen?', back: 'Gas', interval: 0, ease: 2.5, reps: 0, dueAt: Date.now() }
          ];
          save(s);
        }
        return s;
      });
      const [activeId, setActiveId] = useState(() => data.decks[0]?.id || null);
      const [isFlipped, setFlipped] = useState(false);

      useEffect(() => { save(data); }, [data]);

      const decks = useMemo(() => data.decks.map(d => ({ ...d, count: data.cards.filter(c => c.deckId === d.id).length })), [data]);
      const activeDeck = useMemo(() => decks.find(d => d.id === activeId) || null, [decks, activeId]);
      const now = Date.now();
      const dueCards = useMemo(() => data.cards.filter(c => c.deckId === activeId && (c.dueAt || 0) <= now).sort((a,b) => (a.dueAt||0)-(b.dueAt||0)), [data, activeId, now]);
      const current = dueCards[0] || null;

      function addDeck(name) {
        const d = { id: uid(), name };
        setData(s => ({ ...s, decks: [...s.decks, d] }));
        setActiveId(d.id);
      }
      function deleteDeck(id) {
        setData(s => ({ ...s, decks: s.decks.filter(d => d.id !== id), cards: s.cards.filter(c => c.deckId !== id) }));
        if (activeId === id) setActiveId(s => (decks.find(d => d.id !== id)?.id || null));
      }
      function addCard(front, back) {
        if (!activeDeck) return;
        const c = { id: uid(), deckId: activeDeck.id, front, back, interval: 0, ease: 2.5, reps: 0, dueAt: Date.now() };
        setData(s => ({ ...s, cards: [c, ...s.cards] }));
      }
      function deleteCard(id) {
        setData(s => ({ ...s, cards: s.cards.filter(c => c.id !== id) }));
      }
      function flip() { setFlipped(v => !v); }

      function schedule(card, rating) {
        const easeStep = { again: -0.2, good: 0, easy: 0.15 }[rating];
        const base = card.interval || 0;
        let nextInterval;
        if (rating === 'again') nextInterval = 1/24; // ~1 hour
        else if (rating === 'good') nextInterval = Math.max(1, base ? base * 2 : 1);
        else nextInterval = Math.max(3, base ? base * 3 : 3);
        const ease = Math.max(1.3, (card.ease || 2.5) + easeStep);
        const millis = nextInterval * 24 * 60 * 60 * 1000;
        return { ...card, reps: (card.reps||0)+1, ease, interval: nextInterval, dueAt: Date.now() + millis };
      }
      function answer(r) {
        if (!current) return;
        const updated = schedule(current, r);
        setData(s => ({ ...s, cards: s.cards.map(c => c.id === current.id ? updated : c) }));
        setFlipped(false);
      }

      function exportDeck() {
        if (!activeDeck) return;
        const payload = { deck: activeDeck, cards: data.cards.filter(c => c.deckId === activeDeck.id) };
        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${activeDeck.name}.json`; a.click();
      }
      async function importDeck(file) {
        if (!file) return;
        const text = await file.text();
        try {
          const payload = JSON.parse(text);
          if (payload.deck && Array.isArray(payload.cards)) {
            const mapId = new Map();
            const newDeckId = uid();
            mapId.set(payload.deck.id, newDeckId);
            const newDeck = { id: newDeckId, name: payload.deck.name };
            const newCards = payload.cards.map(c => ({ ...c, id: uid(), deckId: newDeckId }));
            setData(s => ({ ...s, decks: [...s.decks, newDeck], cards: [...newCards, ...s.cards] }));
            setActiveId(newDeckId);
          }
        } catch {}
      }

      return (
        <div style={{ display: 'contents' }}>
          <Sidebar decks={decks} activeId={activeId} setActiveId={setActiveId} addDeck={addDeck} deleteDeck={deleteDeck} />
          <main>
            <TopBar theme={theme} setTheme={setTheme} />
            <div className="content">
              <div className="panel">
                <StudyView card={current} flip={flip} isFlipped={isFlipped} answer={answer} />
                {activeDeck && <CardEditor deck={activeDeck} addCard={addCard} importDeck={importDeck} exportDeck={exportDeck} />}
                {activeDeck && <CardTable cards={data.cards.filter(c => c.deckId === activeDeck.id)} deleteCard={deleteCard} />}
              </div>
            </div>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
